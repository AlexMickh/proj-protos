syntax = "proto3";

option go_package = "/auth";

import "google/protobuf/empty.proto";

package auth;

service Auth {
    rpc Register(RegisterRequest) returns (RegisterResponse);
    rpc Login(LoginRequest) returns (LoginResponse);
    rpc Verify(VerifyRequest) returns (VerifyResponse);
    rpc VerifyEmail(VerifyEmailRequest) returns (google.protobuf.Empty);
    rpc GetCurrentSession(GetCurrentSessionRequest) returns (GetCurrentSessionResponse);
    rpc GetAllUserSessions(GetAllUserSessionsRequest) returns (GetAllUserSessionsResponse);
    rpc OauthLogin(OauthLoginRequest) returns (OauthLoginResponse);
    rpc OauthCallback(OauthCallbackRequest) returns (OauthCallbackResponse);
    rpc EnableTotp(EnableTotpRequest) returns (EnableTotpResponse);
}

message RegisterRequest {
    string email = 1;
    string name = 2;
    string password = 3;
    optional string about = 4;
    repeated string skills = 5;
    optional bytes avatar = 6; 
}

message RegisterResponse {
    string id = 1;
}

message LoginRequest {
    string email = 1;
    string password = 2;
    optional string totp_pin = 3;
}

message LoginResponse {
    string session_id = 1;
}

message VerifyRequest {
    string session_id = 1;
}

message VerifyResponse {
    string id = 1;
}

message VerifyEmailRequest {
    string token = 1;
}

message SessionType {
    string session_id = 1;
    string user_id = 2;
    string user_agent = 3;
}

message GetCurrentSessionRequest {
    string session_id = 1;
}

message GetCurrentSessionResponse {
    SessionType session = 1;
}

message GetAllUserSessionsRequest {
    string user_id = 1;
}

message GetAllUserSessionsResponse {
    repeated SessionType sessions = 1;
}

enum OauthProviders {
    YANDEX = 0;
}

message OauthLoginRequest {
    OauthProviders provider = 1;
}

message OauthLoginResponse {
    string url = 1;
}

message OauthCallbackRequest {
    OauthProviders provider = 1;
    string code = 2;
}

message OauthCallbackResponse {
    string session_id = 1;
}

message EnableTotpRequest {
    string email = 1;
}

message EnableTotpResponse {
    string secret = 1;
    bytes qrcode = 2;
}